import pandas as pd
import numpy as py

#CMS documentation: https://www.cms.gov/Research-Statistics-Data-and-Systems/Statistics-Trends-and-Reports/Medicare-Provider-Charge-Data/Downloads/Prescriber_Methods.pdf

path = "../dataincubator/"
CMS = pd.read_csv(path + 'PartD_Prescriber_PUF_NPI_14.csv') 
drug_poisoning = pd.read_csv(path + 'drug_poisoning_deaths_by_state-_us_2013_2014-v7.csv')
CMS.head()
drug_poisoning.head()

for columns in CMS:
    print columns

#CMS.describe()
#total = CMS.TOTAL_DAY_SUPPLY.median()
#claims = CMS.TOTAL_CLAIM_COUNT.median()


CMS['prescription_length'] = CMS.TOTAL_DAY_SUPPLY/CMS.TOTAL_CLAIM_COUNT
CMS['prescription_length'].describe()
CMS['opioidRate'] = CMS.OPIOID_CLAIM_COUNT/CMS.TOTAL_CLAIM_COUNT

CMS.opioidRate.sort_values()   

# Filling missing values 
CMS.opioidRate.fillna(0, inplace=True)

# Checking for missing values 
null_data = CMS[CMS.opioidRate.isnull()]
print null_data

#Checking opioidRate values    
#CMS.iloc[300]   
#CMS[CMS['opioidRate'] ==  0.2]

# histogram of opioid rate  
import matplotlib.pyplot as plt

%matplotlib inline 
CMS.plot(kind='hist', y='opioidRate', figsize=(7,5))

%matplotlib inline 
CMS.plot(kind='hist', y='TOTAL_CLAIM_COUNT', figsize=(7,5))

opioidRate
CMS.boxplot(column='opioidRate', by='NPPES_PROVIDER_STATE', figsize=(20,6))
CMS.boxplot(column='TOTAL_CLAIM_COUNT', by='NPPES_PROVIDER_STATE', showfliers=False, figsize=(20,6))
CMS.groupby('NPPES_PROVIDER_STATE').opioidRate.mean().sort_values()

CMS.OPIOID_BENE_COUNT.sort_values()
# Group by state 
CMS.groupby('NPPES_PROVIDER_STATE').OPIOID_BENE_COUNT.mean().sort_values()
CMS.groupby('NPPES_PROVIDER_STATE').TOTAL_CLAIM_COUNT.mean()





   
